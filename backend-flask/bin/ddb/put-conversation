#!/usr/bin/env python3

import boto3
import sys
from datetime import datetime
import uuid

attrs = {
  'endpoint_url': 'http://localhost:8000'
}

if len(sys.argv) == 2:
  if "prod" in sys.argv[1]:
    attrs = {}

dynamodb = boto3.client('dynamodb',**attrs)
table_name = 'cruddur-messages'

timestamp = datetime.now().isoformat()

message_group_uuid = str(uuid.uuid4())
my_user_uuid = str(uuid.uuid4())
my_user_display_name = "Andrew Brown"
my_user_handle = "andrewbrown"

other_user_uuid = str(uuid.uuid4())
other_user_display_name = "Andrew Bayo"
other_user_handle = "bayko"

# Entity # Message Group ID # User ID
record1 = {
  'pk':   {'S': f"GRP#{message_group_uuid}#{my_user_uuid}"},
  'sk':   {'S': timestamp },
  'data': {'S': my_user_uuid},
  'other_user_uuid': {'S': other_user_uuid},
  'other_user_display_name': {'S': other_user_display_name},
  'other_user_handle': {'S': other_user_handle}
}
response1 = dynamodb.put_item(
  TableName=table_name,
  Item=record1
)

record2 = {
  'pk':   {'S': f"GRP#{message_group_uuid}#{other_user_uuid}"},
  'sk':   {'S': timestamp },
  'data': {'S': other_user_uuid},
  'other_user_uuid': {'S': my_user_uuid},
  'other_user_display_name': {'S': my_user_display_name},
  'other_user_handle': {'S': my_user_handle}
}
response2 = dynamodb.put_item(
  TableName=table_name,
  Item=record2
)

# print the response
print(response1)
print(response2)

print("Message Group UUID")
print(message_group_uuid)